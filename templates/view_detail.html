{% extends "index.html" %}
{% block section %}

<script>
    // 현재 사용자가 이 상품에 좋아요를 눌렀는지 확인
    function showHeart() {
        $.ajax({
            type: 'GET',
            url: '/show_heart/{{ key }}/',
            data: {},
            success: function (response) {
                let my_heart = response['my_heart'];

                if (my_heart && my_heart['interested'] == 'Y') {
                    $("#heart").addClass("red");
                    $("#heart").attr("onclick", "unlike()");
                } else {
                    $("#heart").removeClass("red");
                    $("#heart").attr("onclick", "like()");
                }
            }
        });
    }

    function like() {
        $.ajax({
            type: 'POST',
            url: '/like/{{ key }}/',
            data: { interested: "Y" },
            success: function (response) {
                alert(response['msg']);
                $("#heart").addClass("red");
                $("#heart").attr("onclick", "unlike()");
            }
        });
    }

    function unlike() {
        $.ajax({
            type: 'POST',
            url: '/unlike/{{ key }}/',
            data: { interested: "N" },
            success: function (response) {
                alert(response['msg']);
                $("#heart").removeClass("red");
                $("#heart").attr("onclick", "like()");
            }
        });
    }

    $(document).ready(function () {
        showHeart();
    });
</script>

<div class="top-section">
    <img src="{{ url_for('static', filename='images/' ~ item.img_path) }}" 
         alt="{{ item.name }}" class="product">

    <div class="top-column">
        <p class="product-name">{{ item.name }}</p>
        <p class="price">{{ item.price }}원</p>
        <span id="heart" onclick="like()">♡</span>
        <hr>

        <div class="info">
            <p class="label">판매자</p>
            <p class="value">{{ item.seller }}</p>
        </div>
        <div class="info">
            <p class="label">상품상태</p>
            <p class="value">{{ item.status }}</p>
        </div>
        <div class="info">
            <p class="label">주소</p>
            <p class="value">{{ item.addr }}</p>
        </div>
        <div class="info">
            <p class="label">카테고리</p>
            <p class="value">{{ item.category }}</p>
        </div>
        <div class="info">
            <p class="label">이메일</p>
            <p class="value">{{ item.email }}</p>
        </div>
        <div class="info">
            <p class="label">연락처</p>
            <p class="value">{{ item.phone }}</p>
        </div>

        <div class="buttons">
            <i class="fa fa-heart" id="heart" style="cursor: pointer; font-size: 24px;"></i>
            <button class="buy">구매하기</button>
        </div>
    </div>
</div>

<div class="bottom-section">
    <div class="left-column">
        <p class="small-heading">상품 설명</p>
        <hr>
        <div class="description">
            <p>{{ item.description | safe }}</p>
        </div>
    </div>

    <div class="right-column">
        <p class="small-heading">Q&A</p>

        <div class="qa-box">
            <div class="qa-content">
                
                <div class="question-item">
                    <div class="bubble">
                        <strong>Q</strong>
                        <p>비닐 안 뜯은 새상품 맞나요?</p>
                    </div>
                </div>

                <div class="answer-item">
                    <div class="bubble">
                        <strong>A</strong>
                        <p>상품 설명 읽어주세요 ^^;;</p>
                    </div>
                </div>

                <div class="question-input">
                    <input type="text" id="inputBox" placeholder="판매자에게 질문하기.."/>
                    <button onclick="location.href='/reg_review_init/{{ item.name }}';">
                        리뷰등록
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

{% endblock section %}
