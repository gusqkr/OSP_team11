{% extends "base.html" %}
{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/all_product.css') }}">  
  <script src="{{ url_for('static', filename='js/all_product.js') }}" defer></script>   
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock head %}

{% block section %}
<div class="product-container">

    <div class="product-header">
      <h2>전체 상품 ({{ total_items }}개)</h2>
    </div>

    <div class="product-grid">
      {% if items %}
       {% for key, value in items.items() %}
       <div class="product-card">
        <a href="{{ url_for('view_product_detail', name=key) }}" style="text-decoration: none; color: inherit; display: block;">
        
          <img src="{{ value.img_path }}" alt="상품 이미지">

          <div class="product-info">
           <div class="product-name">{{ value.name }}</div>
           <div class="product-price">{{ value.price }}원</div>
          </div>
        </a>
        
        <div class="heart">
          <button type="button" onclick="showHeart('{{ key }}')" style="border: none; background-color: transparent; cursor: pointer; outline: none;">
            ♡
            <span id="count-{{ key }}">{{ value.heart_count }}</span>
          </button>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>등록된 상품이 없습니다.</p>
    {% endif %}
  </div>

  <div class="pagination">
    {% if total_pages > 0 %}
      {% for i in range(total_pages) %}
        {% set page_num = i + 1 %}

        {% if page_num == page %}
          <button class="active">{{ page_num }}</button>
        {% else %}
          <button onclick="location.href='{{ url_for('view_product', page=page_num) }}'">{{ page_num }}</button>
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</div>

<script>
  function showHeart(name) {
    $.ajax({
      type: 'GET',
      url: '/show_heart/' + name,
      data: {},
      success: function(response) {
        if (response['result'] == 'login_required') {
          alert('로그인이 필요합니다.');
          location.href = '/login';
          return;
        } 

        if (response['result'] == 'success') {
          let id_selector = '#count-' + name;
          $(id_selector).text(response['count']);
        }
      },
      error: function(error){
        console.log(error);
        alert("오류가 발생했습니다. 다시 시도해주세요.");
      }
    });
  }
</script>
{% endblock section %}

